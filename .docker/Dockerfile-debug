FROM golang:1.21.8-bullseye
ENV CGO_ENABLED 1

RUN apt-get update && apt-get install -y --no-install-recommends inotify-tools psmisc
RUN go install github.com/go-delve/delve/cmd/dlv@latest

COPY script/debug-entrypoint.sh /entrypoint.sh

ARG source_dir
VOLUME ${source_dir:-'/dockerdev'}

WORKDIR ${source_dir:-'/dockerdev'}

ENV DELVE_PORT 40000
ENV SERVICE_NAME kratos

EXPOSE 8000 $DELVE_PORT

ENTRYPOINT ["/entrypoint.sh"]
